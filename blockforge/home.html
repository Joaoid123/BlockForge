<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>BlockForge â€“ Home</title>
    <link rel="stylesheet" href="/assets/css/theme.css"/>
  </head>
  <body>
    <header>
      <nav>
        <a href="/home.html">Home</a>
        <a href="/studio.html">Studio</a>
        <button id="logout">Log out</button>
      </nav>
    </header>

    <main>
      <section>
        <h2>Recent games</h2>
        <div id="recent" class="grid"></div>
      </section>

      <section>
        <h2>Recommended for you</h2>
        <div id="recommended" class="grid"></div>
      </section>

      <section>
        <h2>Friends</h2>
        <div id="friends" class="avatars"></div>
      </section>
    </main>

    <script type="module">
      import { requireAuth, logout } from '/js/auth.js';
      import { getFeed } from '/js/home.js';

      const user = requireAuth();
      document.getElementById('logout').onclick = logout;

      const { recent, recommended, friends } = getFeed(user);

      function card(game) {
        const el = document.createElement('a');
        el.className = 'card';
        el.href = `/game.html?id=${encodeURIComponent(game.id)}`;
        el.innerHTML = `
          <img src="${game.thumbnailUrl}" alt="">
          <div class="card-body">
            <h3>${game.title}</h3>
            <p>Plays: ${game.playCount}</p>
          </div>`;
        return el;
      }

      recent.forEach(g => document.getElementById('recent').appendChild(card(g)));
      recommended.forEach(g => document.getElementById('recommended').appendChild(card(g)));

      friends.forEach(f => {
        const el = document.createElement('div');
        el.className = 'avatar';
        el.innerHTML = `<img src="${f.avatarUrl}" alt=""><span>${f.username}</span>`;
        document.getElementById('friends').appendChild(el);
      });
    </script>
  </body>
</html>
